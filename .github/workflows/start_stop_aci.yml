name: Schedule to start / stop Azure Container Instance

on:
  workflow_dispatch:
  schedule:
    # Start at 8:50 AM UTC (weekdays)
    - cron: '50 12 * * 1-5'
    # Stop at 9:20 AM UTC (weekdays)
    - cron: '20 13 * * 1-5'

jobs:
  start-aci:
    if: github.event.schedule == '50 12 * * 1-5'
    runs-on: ubuntu-latest
    steps:
      - name: Log in to Azure
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Start container
        run: |
          az container start \
            --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }} \
            --name ${{ secrets.ACI_NAME }}

  stop-aci:
    runs-on: ubuntu-latest
    steps:
      - name: Log in to Azure
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Stop container
        run: |
          az container stop \
            --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }} \
            --name ${{ secrets.ACI_NAME }}

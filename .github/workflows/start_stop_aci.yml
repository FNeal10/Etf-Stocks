name: Start / stop Azure Container Instance

on:
  workflow_dispatch:
  workflow_call: 
    inputs:
      action:
        description: 'Action to perform'
        required: true
        default: 'start'
        type: string
    secrets:
      AZURE_CREDENTIALS:
        description: 'Azure credentials'
        required: true
      AZURE_RESOURCE_GROUP:
        description: 'Azure resource group'
        required: true
      ACI_NAME:
        description: 'Azure Container Instance name'
        required: true
      

jobs:
  manage-aci:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Azure using Service Principal
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: start or stop aci
        run: |
          if [ "${{ inputs.action }}" == "start" ]; then
            az container start \
              --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }} \
              --name ${{ secrets.ACI_NAME }}
          else
            az container stop \
              --resource-group ${{ secrets.AZURE_RESOURCE_GROUP }} \
              --name ${{ secrets.ACI_NAME }}
          fi
